import { renderBlock } from './lib.js';
import { renderSearchResultsBlock } from './search-results.js';
import { rentSDKProvider } from './bookingService/providers/rentSDK/rentSDKProvider.js';
import { jsonAPIProvider } from './bookingService/providers/jsonAPI/jsonAPIProvider.js';
export function renderSearchFormBlock(arrivalDate, departureDate) {
    const date = new Date();
    const day = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
    const month = date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1;
    const year = date.getFullYear() + '';
    const minDate = `${year}-${month}-${day}`;
    let maxDate;
    if (month !== '12') {
        const nextMonth = date.getMonth() + 2 < 10 ? '0' + (date.getMonth() + 2) : (date.getMonth() + 2) + '';
        const lastDay = new Date(date.getFullYear(), date.getMonth() + 2, 0).getDate() + '';
        console.log(lastDay);
        maxDate = `${year}-${nextMonth}-${lastDay}`;
    }
    else {
        const nextMonth = '00';
        const lastDay = new Date((date.getFullYear() + 1), date.getMonth() + 2, 0).getDate() + '';
        const nextYear = (date.getFullYear() + 1) + '';
        maxDate = `${nextYear}-${nextMonth}-${lastDay}`;
    }
    console.log(arrivalDate, departureDate, 'date: ' + date, 'day: ' + day, 'month: ' + month, 'year: ' + year, minDate, maxDate);
    renderBlock('search-form-block', `
    <form id="form">
      <fieldset class="search-filedset">
        <div class="row">
          <div>
            <label for="city">Город</label>
            <input id="city" type="text" disabled value="Санкт-Петербург" />
            <input type="hidden" disabled value="59.9386,30.3141" />
          </div>
          <div class="providers">
            <label><input id="homy" type="checkbox" name="provider" value="homy" checked /> Homy</label>
            <label><input id="flat-rent" type="checkbox" name="provider" value="flat-rent" checked /> FlatRent</label>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="check-in-date">Дата заезда</label>
            <input id="check-in-date" type="date" value="${arrivalDate}" min="${minDate}" max="${maxDate}" name="checkin" />
          </div>
          <div>
            <label for="check-out-date">Дата выезда</label>
            <input id="check-out-date" type="date" value="${departureDate}" min="${minDate}" max="${maxDate}" name="checkout" />
          </div>
          <div>
            <label for="max-price">Макс. цена суток</label>
            <input id="max-price" type="text" value="20000" name="price" class="max-price" />
          </div>
          
          <div>
            <div><button class="form__btn">Найти</button></div>
          </div>
        </div>
      </fieldset>
    </form>
    `);
    const btnSearch = document.querySelector('.form__btn');
    const city = document.querySelector('#city');
    const checkInDate = document.querySelector('#check-in-date');
    const checkOutDate = document.querySelector('#check-out-date');
    const maxPrice = document.querySelector('#max-price');
    const providerHomy = document.querySelector('#homy');
    const providerFlatRent = document.querySelector('#flat-rent');
    const placeF = (placeVal) => {
        console.log(placeVal);
        return placeVal;
    };
    const search = (searchData, place) => {
        console.log(place);
        const allProviders = [];
        const jsonAPIex = new jsonAPIProvider();
        const rentSDKEx = new rentSDKProvider();
        const jsonAPIFilter = {
            'city': searchData.city,
            'checkInDate': searchData.checkInDate,
            'checkOutDate': searchData.checkOutDate,
            'maxPrice': searchData.maxPrice
        };
        const rentSDKFilter = {
            'city': searchData.city,
            'checkInDate': new Date(searchData.checkInDate),
            'checkOutDate': new Date(searchData.checkOutDate),
            'priceLimit': searchData.maxPrice
        };
        if (providerHomy !== null && providerHomy.checked) {
            console.log('homy checked');
            allProviders.push(jsonAPIex);
        }
        if (providerFlatRent !== null && providerFlatRent.checked) {
            allProviders.push(rentSDKEx);
        }
        Promise.all(allProviders.map((provider) => {
            if (provider === jsonAPIex) {
                return provider.find(jsonAPIFilter);
            }
            if (provider === rentSDKEx) {
                return provider.find(rentSDKFilter);
            }
            return null;
        })).then((res) => {
            if (res !== undefined) {
                const allResults = [].concat(...res);
                console.log(allResults);
                renderSearchResultsBlock(allResults);
            }
        });
    };
    if (btnSearch !== null) {
        btnSearch.addEventListener('click', (evt) => {
            evt.preventDefault();
            if (city && checkInDate && checkOutDate && maxPrice) {
                const cityValue = city.value;
                const checkInDateValue = checkInDate.value;
                const checkOutDateValue = checkOutDate.value;
                const maxPriceValue = +maxPrice.value;
                const data = {
                    city: cityValue,
                    checkInDate: checkInDateValue,
                    checkOutDate: checkOutDateValue,
                    maxPrice: maxPriceValue
                };
                search(data, placeF);
            }
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZvcm0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VhcmNoLWZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUN0QyxPQUFPLEVBQUMsd0JBQXdCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sdURBQXVELENBQUM7QUFDdEYsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLHVEQUF1RCxDQUFDO0FBR3RGLE1BQU0sVUFBVSxxQkFBcUIsQ0FBRSxXQUFtQixFQUFFLGFBQXFCO0lBQy9FLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUE7SUFDdkIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ3ZFLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDMUYsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUUsQ0FBQTtJQUNwQyxNQUFNLE9BQU8sR0FBRyxHQUFHLElBQUksSUFBSSxLQUFLLElBQUksR0FBRyxFQUFFLENBQUE7SUFDekMsSUFBSSxPQUFjLENBQUE7SUFFbEIsSUFBRyxLQUFLLEtBQUssSUFBSSxFQUFFO1FBQ2pCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxD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LE1BQU0sQ0FBQyxHQUFHLEdBQVMsQ0FBQyxDQUFBO2dCQUN4RCxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBO2dCQUN2Qix3QkFBd0IsQ0FBQyxVQUFVLENBQUMsQ0FBQTthQUNyQztRQUNILENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFBO0lBRUQsSUFBRyxTQUFTLEtBQUssSUFBSSxFQUFFO1FBQ3JCLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFHLEVBQU0sRUFBRTtZQUM5QyxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUE7WUFDcEIsSUFBRyxJQUFJLElBQUksV0FBVyxJQUFJLFlBQVksSUFBSSxRQUFRLEVBQUU7Z0JBQ2xELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7Z0JBQzVCLE1BQU0sZ0JBQWdCLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQTtnQkFDMUMsTUFBTSxpQkFBaUIsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFBO2dCQUM1QyxNQUFNLGFBQWEsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUE7Z0JBQ3JDLE1BQU0sSUFBSSxHQUFtQjtvQkFDM0IsSUFBSSxFQUFFLFNBQVM7b0JBQ2YsV0FBVyxFQUFDLGdCQUFnQjtvQkFDNUIsWUFBWSxFQUFFLGlCQUFpQjtvQkFDL0IsUUFBUSxFQUFFLGFBQWE7aUJBQ3hCLENBQUE7Z0JBQ0QsTUFBTSxDQUFDLElBQUksRUFBQyxNQUFNLENBQUMsQ0FBQTthQUNwQjtRQUVILENBQUMsQ0FBQyxDQUFBO0tBQ0g7QUFFSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVuZGVyQmxvY2sgfSBmcm9tICcuL2xpYi5qcydcbmltcG9ydCB7cmVuZGVyU2VhcmNoUmVzdWx0c0Jsb2NrfSBmcm9tICcuL3NlYXJjaC1yZXN1bHRzLmpzJztcbmltcG9ydCB7cmVudFNES1Byb3ZpZGVyfSBmcm9tICcuL2Jvb2tpbmdTZXJ2aWNlL3Byb3ZpZGVycy9yZW50U0RLL3JlbnRTREtQcm92aWRlci5qcyc7XG5pbXBvcnQge2pzb25BUElQcm92aWRlcn0gZnJvbSAnLi9ib29raW5nU2VydmljZS9wcm92aWRlcnMvanNvbkFQSS9qc29uQVBJUHJvdmlkZXIuanMnO1xuaW1wb3J0IHtBcGFydG1lbnRzfSBmcm9tICcuL2Jvb2tpbmdTZXJ2aWNlL2RvbWFpbi9hcGFydG1lbnRzJztcblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlclNlYXJjaEZvcm1CbG9jayAoYXJyaXZhbERhdGU6IHN0cmluZywgZGVwYXJ0dXJlRGF0ZTogc3RyaW5nKSB7XG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXG4gIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpIDwgMTAgPyAnMCcgKyBkYXRlLmdldERhdGUoKSA6IGRhdGUuZ2V0RGF0ZSgpXG4gIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMSA8IDEwID8gJzAnICsgKGRhdGUuZ2V0TW9udGgoKSArIDEpIDogZGF0ZS5nZXRNb250aCgpICsgMVxuICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpICsgJydcbiAgY29uc3QgbWluRGF0ZSA9IGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fWBcbiAgbGV0IG1heERhdGU6c3RyaW5nXG5cbiAgaWYobW9udGggIT09ICcxMicpIHtcbiAgICBjb25zdCBuZXh0TW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAyIDwgMTAgPyAnMCcgKyAoZGF0ZS5nZXRNb250aCgpICsgMikgOiAoZGF0ZS5nZXRNb250aCgpICsgMikgKyAnJ1xuICAgIGNvbnN0IGxhc3REYXkgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDIsIDApLmdldERhdGUoKSArICcnXG4gICAgY29uc29sZS5sb2cobGFzdERheSlcbiAgICBtYXhEYXRlID0gYCR7eWVhcn0tJHtuZXh0TW9udGh9LSR7bGFzdERheX1gXG4gIH0gZWxzZSB7XG4gICAgY29uc3QgIG5leHRNb250aCA9ICcwMCdcbiAgICBjb25zdCBsYXN0RGF5ID0gbmV3IERhdGUoKGRhdGUuZ2V0RnVsbFllYXIoKSArIDEpLCBkYXRlLmdldE1vbnRoKCkgKyAyLCAwKS5nZXREYXRlKCkgKyAnJ1xuICAgIGNvbnN0IG5leHRZZWFyID0gKGRhdGUuZ2V0RnVsbFllYXIoKSArIDEpICsgJydcbiAgICBtYXhEYXRlID0gYCR7bmV4dFllYXJ9LSR7bmV4dE1vbnRofS0ke2xhc3REYXl9YFxuICB9XG5cbiAgY29uc29sZS5sb2coYXJyaXZhbERhdGUsIGRlcGFydHVyZURhdGUsICdkYXRlOiAnICsgZGF0ZSAsJ2RheTogJysgZGF5LCAnbW9udGg6ICcgKyBtb250aCxcbiAgICAneWVhcjogJyArIHllYXIsIG1pbkRhdGUsIG1heERhdGUpXG4gIHJlbmRlckJsb2NrKFxuICAgICdzZWFyY2gtZm9ybS1ibG9jaycsXG4gICAgYFxuICAgIDxmb3JtIGlkPVwiZm9ybVwiPlxuICAgICAgPGZpZWxkc2V0IGNsYXNzPVwic2VhcmNoLWZpbGVkc2V0XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNpdHlcIj7Qk9C+0YDQvtC0PC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNpdHlcIiB0eXBlPVwidGV4dFwiIGRpc2FibGVkIHZhbHVlPVwi0KHQsNC90LrRgi3Qn9C10YLQtdGA0LHRg9GA0LNcIiAvPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBkaXNhYmxlZCB2YWx1ZT1cIjU5LjkzODYsMzAuMzE0MVwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByb3ZpZGVyc1wiPlxuICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBpZD1cImhvbXlcIiB0eXBlPVwiY2hlY2tib3hcIiBuYW1lPVwicHJvdmlkZXJcIiB2YWx1ZT1cImhvbXlcIiBjaGVja2VkIC8+IEhvbXk8L2xhYmVsPlxuICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBpZD1cImZsYXQtcmVudFwiIHR5cGU9XCJjaGVja2JveFwiIG5hbWU9XCJwcm92aWRlclwiIHZhbHVlPVwiZmxhdC1yZW50XCIgY2hlY2tlZCAvPiBGbGF0UmVudDwvbGFiZWw+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjaGVjay1pbi1kYXRlXCI+0JTQsNGC0LAg0LfQsNC10LfQtNCwPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNoZWNrLWluLWRhdGVcIiB0eXBlPVwiZGF0ZVwiIHZhbHVlPVwiJHthcnJpdmFsRGF0ZX1cIiBtaW49XCIke21pbkRhdGV9XCIgbWF4PVwiJHttYXhEYXRlfVwiIG5hbWU9XCJjaGVja2luXCIgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNoZWNrLW91dC1kYXRlXCI+0JTQsNGC0LAg0LLRi9C10LfQtNCwPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCBpZD1cImNoZWNrLW91dC1kYXRlXCIgdHlwZT1cImRhdGVcIiB2YWx1ZT1cIiR7ZGVwYXJ0dXJlRGF0ZX1cIiBtaW49XCIke21pbkRhdGV9XCIgbWF4PVwiJHttYXhEYXRlfVwiIG5hbWU9XCJjaGVja291dFwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJtYXgtcHJpY2VcIj7QnNCw0LrRgS4g0YbQtdC90LAg0YHRg9GC0L7QujwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJtYXgtcHJpY2VcIiB0eXBlPVwidGV4dFwiIHZhbHVlPVwiMjAwMDBcIiBuYW1lPVwicHJpY2VcIiBjbGFzcz1cIm1heC1wcmljZVwiIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgXG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxkaXY+PGJ1dHRvbiBjbGFzcz1cImZvcm1fX2J0blwiPtCd0LDQudGC0Lg8L2J1dHRvbj48L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2ZpZWxkc2V0PlxuICAgIDwvZm9ybT5cbiAgICBgXG4gIClcblxuICBjb25zdCBidG5TZWFyY2ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZm9ybV9fYnRuJylcbiAgY29uc3QgY2l0eTpIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjaXR5JylcbiAgY29uc3QgY2hlY2tJbkRhdGU6SFRNTElucHV0RWxlbWVudCB8IG51bGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2hlY2staW4tZGF0ZScpXG4gIGNvbnN0IGNoZWNrT3V0RGF0ZTpIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjaGVjay1vdXQtZGF0ZScpXG4gIGNvbnN0IG1heFByaWNlOkhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21heC1wcmljZScpXG4gIGNvbnN0IHByb3ZpZGVySG9teTpIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNob215JylcbiAgY29uc3QgcHJvdmlkZXJGbGF0UmVudDpIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmbGF0LXJlbnQnKVxuXG4gIGludGVyZmFjZSBJU2VhcmNoRm9ybURhdGEge1xuICAgIGNpdHk6IHN0cmluZyxcbiAgICBjaGVja0luRGF0ZTogc3RyaW5nLFxuICAgIGNoZWNrT3V0RGF0ZTogc3RyaW5nLFxuICAgIG1heFByaWNlOiBudW1iZXJcbiAgfVxuXG4gIGludGVyZmFjZSBJUGxhY2Uge1xuICAgIGlkOiBudW1iZXIsXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgaW1hZ2U6IHN0cmluZyxcbiAgICByZW1vdGVuZXNzOiBudW1iZXIsXG4gICAgYm9va2VkRGF0ZXM6IFtdLFxuICAgIHByaWNlOiBudW1iZXJcbiAgfVxuXG4gIGNvbnN0IHBsYWNlRiA9IChwbGFjZVZhbDogSVBsYWNlW10gfCBFcnJvcik6IElQbGFjZVtdIHwgRXJyb3IgPT4ge1xuICAgIGNvbnNvbGUubG9nKHBsYWNlVmFsKVxuICAgIHJldHVybiBwbGFjZVZhbFxuICB9XG5cbiAgY29uc3Qgc2VhcmNoID0gKHNlYXJjaERhdGE6IElTZWFyY2hGb3JtRGF0YSwgcGxhY2U6KChwbGFjZVZhbDogSVBsYWNlW10gfCBFcnJvcikgPT4gSVBsYWNlW10gfCBFcnJvcikpOnZvaWQgPT4ge1xuICAgIGNvbnNvbGUubG9nKHBsYWNlKVxuICAgIGNvbnN0IGFsbFByb3ZpZGVycyA9IFtdXG4gICAgY29uc3QganNvbkFQSWV4ID0gbmV3IGpzb25BUElQcm92aWRlcigpXG4gICAgY29uc3QgcmVudFNES0V4ID0gbmV3IHJlbnRTREtQcm92aWRlcigpXG4gICAgY29uc3QganNvbkFQSUZpbHRlciA9IHtcbiAgICAgICdjaXR5Jzogc2VhcmNoRGF0YS5jaXR5LFxuICAgICAgJ2NoZWNrSW5EYXRlJzogc2VhcmNoRGF0YS5jaGVja0luRGF0ZSxcbiAgICAgICdjaGVja091dERhdGUnOiBzZWFyY2hEYXRhLmNoZWNrT3V0RGF0ZSxcbiAgICAgICdtYXhQcmljZSc6IHNlYXJjaERhdGEubWF4UHJpY2VcbiAgICB9XG4gICAgY29uc3QgcmVudFNES0ZpbHRlciA9IHtcbiAgICAgICdjaXR5Jzogc2VhcmNoRGF0YS5jaXR5LFxuICAgICAgJ2NoZWNrSW5EYXRlJzogbmV3IERhdGUoc2VhcmNoRGF0YS5jaGVja0luRGF0ZSksXG4gICAgICAnY2hlY2tPdXREYXRlJzogbmV3IERhdGUoc2VhcmNoRGF0YS5jaGVja091dERhdGUpLFxuICAgICAgJ3ByaWNlTGltaXQnOiBzZWFyY2hEYXRhLm1heFByaWNlXG4gICAgfVxuICAgIGlmKHByb3ZpZGVySG9teSAhPT0gbnVsbCAmJiBwcm92aWRlckhvbXkuY2hlY2tlZCkge1xuICAgICAgY29uc29sZS5sb2coJ2hvbXkgY2hlY2tlZCcpXG4gICAgICBhbGxQcm92aWRlcnMucHVzaChqc29uQVBJZXgpXG4gICAgfVxuICAgIGlmKHByb3ZpZGVyRmxhdFJlbnQgIT09IG51bGwgJiYgcHJvdmlkZXJGbGF0UmVudC5jaGVja2VkKSB7XG4gICAgICBhbGxQcm92aWRlcnMucHVzaChyZW50U0RLRXgpXG4gICAgfVxuXG4gICAgUHJvbWlzZS5hbGwoYWxsUHJvdmlkZXJzLm1hcCgocHJvdmlkZXI6IGpzb25BUElQcm92aWRlciB8IHJlbnRTREtQcm92aWRlcikgPT4ge1xuICAgICAgaWYocHJvdmlkZXIgPT09IGpzb25BUElleCkge1xuICAgICAgICByZXR1cm4gIHByb3ZpZGVyLmZpbmQoanNvbkFQSUZpbHRlcilcbiAgICAgIH1cbiAgICAgIGlmKHByb3ZpZGVyID09PSByZW50U0RLRXggKSB7XG4gICAgICAgIHJldHVybiBwcm92aWRlci5maW5kKHJlbnRTREtGaWx0ZXIpXG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH0pKS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmKHJlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnN0IGFsbFJlc3VsdHM6IEFwYXJ0bWVudHNbXSA9IFtdLmNvbmNhdCguLi5yZXMgYXMgW10pXG4gICAgICAgIGNvbnNvbGUubG9nKGFsbFJlc3VsdHMpXG4gICAgICAgIHJlbmRlclNlYXJjaFJlc3VsdHNCbG9jayhhbGxSZXN1bHRzKVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBpZihidG5TZWFyY2ggIT09IG51bGwpIHtcbiAgICBidG5TZWFyY2guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZ0KTp2b2lkPT57XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKVxuICAgICAgaWYoY2l0eSAmJiBjaGVja0luRGF0ZSAmJiBjaGVja091dERhdGUgJiYgbWF4UHJpY2UpIHtcbiAgICAgICAgY29uc3QgY2l0eVZhbHVlID0gY2l0eS52YWx1ZVxuICAgICAgICBjb25zdCBjaGVja0luRGF0ZVZhbHVlID0gY2hlY2tJbkRhdGUudmFsdWVcbiAgICAgICAgY29uc3QgY2hlY2tPdXREYXRlVmFsdWUgPSBjaGVja091dERhdGUudmFsdWVcbiAgICAgICAgY29uc3QgbWF4UHJpY2VWYWx1ZSA9ICttYXhQcmljZS52YWx1ZVxuICAgICAgICBjb25zdCBkYXRhOklTZWFyY2hGb3JtRGF0YSA9IHtcbiAgICAgICAgICBjaXR5OiBjaXR5VmFsdWUsXG4gICAgICAgICAgY2hlY2tJbkRhdGU6Y2hlY2tJbkRhdGVWYWx1ZSxcbiAgICAgICAgICBjaGVja091dERhdGU6IGNoZWNrT3V0RGF0ZVZhbHVlLFxuICAgICAgICAgIG1heFByaWNlOiBtYXhQcmljZVZhbHVlXG4gICAgICAgIH1cbiAgICAgICAgc2VhcmNoKGRhdGEscGxhY2VGKVxuICAgICAgfVxuXG4gICAgfSlcbiAgfVxuXG59XG4iXX0=